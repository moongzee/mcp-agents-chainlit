import chainlit as cl

async def send_error_with_reset_guidance(error_message: str, error_type: str = "일반"):
    """에러 메시지와 함께 대화 초기화 안내를 보내는 함수"""

    # 🎨 에러 타입별 맞춤 메시지
    if error_type == "네트워크":
        reset_guidance = """
🔄 **해결 방법:**
1. **새로운 대화 시작**: 브라우저를 새로고침하거나 새 탭에서 대화를 시작해보세요
2. **잠시 후 재시도**: 네트워크가 안정된 후 다시 시도해주세요
3. **짧은 메시지로 시도**: 긴 질문 대신 짧은 메시지로 시작해보세요

💡 **팁**: 새로고침 후에도 같은 문제가 반복되면, 몇 분 후에 다시 접속해보세요.
"""
    elif error_type == "API":
        reset_guidance = """
🔄 **해결 방법:**
1. **새로운 대화 시작**: 페이지를 새로고침하여 새로운 대화를 시작해주세요
2. **잠시 대기**: API 서버가 안정화될 때까지 5-10분 정도 기다려주세요
3. **간단한 질문부터**: 복잡한 작업보다는 간단한 질문부터 시작해보세요

💡 **팁**: 서버 과부하가 해소되면 정상적으로 이용하실 수 있습니다.
"""
    elif error_type == "메모리":
        reset_guidance = """
🔄 **해결 방법:**
1. **즉시 새로고침**: 브라우저를 새로고침하여 메모리를 초기화해주세요
2. **대화 기록 정리**: 너무 긴 대화는 새로운 세션에서 시작하는 것이 좋습니다
3. **단계별 질문**: 복합적인 질문보다는 단계별로 나누어 질문해주세요

💡 **팁**: 새 대화에서는 이전 내용을 간단히 요약해서 다시 질문해주세요.
"""
    else:  # 일반 에러
        reset_guidance = """
🔄 **해결 방법:**
1. **페이지 새로고침**: F5키나 브라우저 새로고침 버튼을 눌러주세요
2. **새 탭에서 시작**: 새로운 브라우저 탭에서 대화를 시작해보세요
3. **잠시 후 재시도**: 몇 분 후에 다시 시도해보세요

💡 **지속적인 문제**: 계속 같은 오류가 발생하면 브라우저 캐시를 삭제해보세요.
"""

    # 🚨 에러 메시지 + 안내사항 결합
    full_message = f"""⚠️ **오류 발생**: {error_message}

{reset_guidance}

🔧 **빠른 해결**: 지금 바로 **Ctrl+F5** (Windows) 또는 **Cmd+R** (Mac)을 눌러 새로고침해보세요!
"""

    await cl.Message(content=full_message).send()

async def send_critical_error_guidance():
    """심각한 에러 발생 시 상세한 안내를 보내는 함수"""

    critical_guidance = """
🚨 **시스템 오류가 발생했습니다**

이 문제를 해결하기 위해 다음 단계를 따라해주세요:

### 🔄 **즉시 해결 방법**
1. **브라우저 새로고침**: `F5` 또는 `Ctrl+F5`를 눌러주세요
2. **새 탭 열기**: 새로운 브라우저 탭에서 다시 접속해주세요
3. **5분 대기**: 시스템이 안정화될 때까지 잠시 기다려주세요

### 🛠️ **추가 해결 방법**
- **브라우저 캐시 삭제**: 설정 > 개인정보 > 인터넷 사용 기록 삭제
- **다른 브라우저 사용**: Chrome, Firefox, Safari 등 다른 브라우저 시도
- **인터넷 연결 확인**: Wi-Fi 또는 네트워크 연결 상태 점검

### 💬 **새 대화 시작하기**
문제가 해결되면 간단한 인사말("안녕하세요")로 새 대화를 시작해보세요!

---
*문제가 계속 발생하면 잠시 후 다시 시도해주세요. 시스템이 자동으로 복구됩니다.*
"""

    await cl.Message(content=critical_guidance).send() 